<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#050202" />
  <title>Moloch Grove | Rituale</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --bg: #020101;
      --fg: #e7e5e4;
    }

    html, body { height: 100%; overflow: hidden; /* Prevent scroll on shake */ }
    body {
      font-family: 'Inter', serif;
      background-color: var(--bg);
      color: var(--fg);
      /* Subtle noise texture */
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
    }

    h1, h2, h3, .ritual-font { font-family: 'Cinzel', serif; }

    /* Animations */
    @keyframes fadeInDown {
      0% { opacity: 0; transform: translateY(-20px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .animate-enter { animation: fadeInDown 1s cubic-bezier(0.2, 0.8, 0.2, 1) both; }

    @keyframes flicker {
      0%, 100% { opacity: 1; text-shadow: 0 0 15px rgba(220, 38, 38, 0.6); }
      50% { opacity: 0.82; text-shadow: 0 0 30px rgba(220, 38, 38, 0.4); }
    }
    .flicker-text { animation: flicker 5s infinite alternate; }

    /* Earthquake Animation */
    @keyframes earthquake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-0.5deg); }
      20% { transform: translate(-2px, 0px) rotate(0.5deg); }
      30% { transform: translate(2px, 1px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(0.5deg); }
      50% { transform: translate(-1px, 1px) rotate(-0.5deg); }
      60% { transform: translate(-2px, 1px) rotate(0deg); }
      70% { transform: translate(2px, 1px) rotate(-0.5deg); }
      80% { transform: translate(-1px, -1px) rotate(0.5deg); }
      90% { transform: translate(1px, 1px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-0.5deg); }
    }
    
    .shake-screen {
      animation: earthquake 0.4s infinite; /* Fast vibration */
      will-change: transform;
    }

    .input-ritual {
      background: rgba(10, 10, 10, 0.6);
      border: 1px solid #292524;
      transition: all .3s ease;
      backdrop-filter: blur(4px);
      font-family: 'Cinzel', serif; /* Elegant font applied */
    }
    .input-ritual:focus {
      border-color: #7f1d1d;
      box-shadow: 0 0 25px rgba(127, 29, 29, 0.2);
      outline: none;
      background: rgba(0,0,0,0.8);
    }
    .input-ritual::placeholder {
        font-family: 'Inter', sans-serif;
        font-size: 0.8em;
        letter-spacing: normal;
    }

    /* Eye Colors Classes */
    .eye-base { transition: fill 1.5s ease, filter 1.5s ease; }
    .eyes-red { fill: #dc2626; filter: drop-shadow(0 0 15px #ef4444); }
    .eyes-gold { fill: #fbbf24; filter: drop-shadow(0 0 15px #f59e0b); }
    .eyes-dark { fill: #44403c; filter: drop-shadow(0 0 2px #000); }

    /* Owl Container Glows */
    .owl-container { transition: all 1.5s ease; }
    .glow-red { box-shadow: 0 0 80px -5px rgba(220, 38, 38, 0.6); border-color: rgba(127, 29, 29, 1); transform: scale(1.05); }
    .glow-gold { box-shadow: 0 0 80px -5px rgba(245, 158, 11, 0.6); border-color: rgba(180, 83, 9, 1); transform: scale(1.05); }
    .glow-neutral { box-shadow: 0 0 40px -10px rgba(0,0,0,0.8); border-color: #292524; }

    /* Terminal */
    .terminal-bg {
      background-color: #080505;
      background-image:
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
      background-size: 100% 3px, 3px 100%;
      border-top: 1px solid #292524;
    }

    /* Buttons */
    .btn-ritual {
      position: relative;
      overflow: hidden;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid;
    }
    .btn-ritual:active { transform: scale(0.92); }

    .btn-curse {
      background: linear-gradient(160deg, #1a0505 0%, #450a0a 100%);
      border-color: #7f1d1d;
    }
    .btn-curse:hover {
      box-shadow: 0 0 30px rgba(220, 38, 38, 0.4);
      border-color: #ef4444;
    }

    .btn-bless {
      background: linear-gradient(160deg, #1a1005 0%, #451a03 100%);
      border-color: #78350f;
    }
    .btn-bless:hover {
      box-shadow: 0 0 30px rgba(245, 158, 11, 0.3);
      border-color: #fbbf24;
    }

    /* Fire */
    .fire-container {
      position: fixed;
      bottom: 0; left: 0;
      width: 100%;
      height: 40vh; /* Taller on mobile for better effect */
      z-index: 0;
      pointer-events: none;
      mask-image: linear-gradient(to top, black 20%, transparent 100%);
      -webkit-mask-image: linear-gradient(to top, black 20%, transparent 100%);
    }
    .fire-particle {
      position: absolute;
      bottom: -20px;
      width: 40px; height: 40px;
      background: radial-gradient(circle, rgba(200,50,0,0.7) 0%, rgba(0,0,0,0) 70%);
      border-radius: 50%;
      opacity: 0;
      animation: rise 4s infinite ease-in;
      filter: blur(8px);
      mix-blend-mode: screen;
    }
    @keyframes rise {
      0% { opacity: 0; transform: translateY(0) scale(1) translateX(0); }
      50% { opacity: 0.6; transform: translateY(-100px) scale(1.5) translateX(10px); }
      100% { opacity: 0; transform: translateY(-300px) scale(0.5) translateX(-10px); }
    }

    /* Loader */
    .loader {
      width: 4px;
      height: 4px;
      background-color: currentColor;
      box-shadow: 0 0 10px currentColor;
      border-radius: 50%;
      animation: loaderPulse 1s infinite alternate;
    }
    .loader:before, .loader:after {
      content: "";
      position: absolute;
      width: 4px; height: 4px;
      background-color: currentColor;
      border-radius: 50%;
      animation: loaderPulse 1s infinite alternate;
    }
    .loader:before { left: -10px; animation-delay: 0.2s; }
    .loader:after { right: -10px; animation-delay: 0.4s; }

    @keyframes loaderPulse { 0% { opacity: 0.3; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1.2); } }

    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4 relative selection:bg-red-900 selection:text-white">
  
  <!-- FIRE BACKGROUND -->
  <div class="fire-container" id="fireContainer" aria-hidden="true"></div>

  <!-- MAIN WRAPPER: Handles the shake animation -->
  <div class="relative z-10 w-full max-w-lg flex flex-col items-center transition-transform duration-300 transform-gpu" id="mainContainer">
    
    <!-- HEADER / MOLOCH OWL -->
    <header class="mb-4 md:mb-8 text-center animate-enter w-full flex flex-col items-center justify-center">
      
      <!-- Responsive sizing: smaller on mobile, larger on desktop -->
      <div id="owlContainer" class="owl-container glow-neutral inline-block p-8 md:p-12 rounded-full border-2 bg-stone-950/90 mb-4 md:mb-8 relative overflow-hidden transition-transform duration-500">
        
        <!-- SVG Icon -->
        <svg class="w-32 h-32 md:w-48 md:h-48 text-stone-300" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <!-- Detailed Horns/Ears -->
          <path d="M20 35 L15 10 L35 25 L50 15 L65 25 L85 10 L80 35" stroke-width="2" />
          
          <!-- Head Shape -->
          <path d="M20 35 C10 55, 15 85, 30 95 L50 100 L70 95 C85 85, 90 55, 80 35" fill="#0c0a09" stroke-width="2"/>
          
          <!-- Inner Face Details -->
          <path d="M35 55 Q50 65 65 55" stroke-opacity="0.3" />
          <path d="M50 35 L50 50" stroke-opacity="0.3" />

          <!-- Eyes (Dynamic Fill) -->
          <circle cx="35" cy="45" r="11" stroke="none" fill="#1c1917" />
          <circle cx="65" cy="45" r="11" stroke="none" fill="#1c1917" />
          
          <!-- Pupils (The changing part) -->
          <circle id="eyeLeft" cx="35" cy="45" r="5" class="eye-base eyes-dark" />
          <circle id="eyeRight" cx="65" cy="45" r="5" class="eye-base eyes-dark" />

          <!-- Beak -->
          <path d="M50 60 L44 75 L56 75 Z" fill="#292524" stroke="none" />
          
          <!-- Wing Hints -->
          <path d="M10 60 Q0 80 20 85" stroke-opacity="0.4" />
          <path d="M90 60 Q100 80 80 85" stroke-opacity="0.4" />
        </svg>
      </div>

      <h1 class="text-5xl md:text-6xl text-stone-100 font-black tracking-widest ritual-font flicker-text mb-2 drop-shadow-2xl">MOLOCH</h1>
      <div class="h-px w-24 md:w-32 bg-gradient-to-r from-transparent via-red-900 to-transparent mb-1"></div>
      <p class="text-stone-500 uppercase tracking-[0.5em] text-[10px] font-bold">Cremation of Care</p>
    </header>

    <main class="w-full bg-[#0a0a0a]/95 border border-stone-800/60 shadow-[0_0_80px_rgba(0,0,0,1)] rounded-xl overflow-hidden backdrop-blur-xl animate-enter" style="animation-delay: 0.1s;">
      
      <div class="p-6 md:p-8 space-y-6 md:space-y-8">
        <!-- Input -->
        <div class="relative group">
          <div class="absolute inset-0 bg-red-900/10 blur-lg rounded-full opacity-0 group-focus-within:opacity-100 transition-opacity duration-500"></div>
          <input
            type="text"
            id="targetName"
            placeholder="NOME DEL SACRIFICIO"
            class="relative w-full py-4 text-stone-200 rounded-lg input-ritual placeholder-stone-700 text-xl md:text-2xl font-bold tracking-[0.05em] bg-black/40 text-center uppercase focus:text-white"
            autocomplete="off"
            enterkeyhint="go"
          />
        </div>

        <!-- Buttons -->
        <div class="grid grid-cols-2 gap-4 md:gap-5">
          <button type="button" id="btnBless" class="btn-ritual btn-bless group text-amber-100 py-5 md:py-6 rounded-lg active:bg-amber-900/40 touch-manipulation">
            <div class="relative z-10 flex flex-col items-center gap-2">
              <i data-lucide="sun" class="w-5 h-5 md:w-6 md:h-6 text-amber-500/80 group-hover:scale-110 group-hover:rotate-45 transition-transform duration-500"></i>
              <span class="ritual-font font-bold tracking-[0.1em] md:tracking-[0.2em] text-[10px] uppercase">Benedizione</span>
            </div>
            <!-- Shine effect -->
            <div class="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] bg-gradient-to-r from-transparent via-white/5 to-transparent skew-x-12"></div>
          </button>

          <button type="button" id="btnCurse" class="btn-ritual btn-curse group text-red-100 py-5 md:py-6 rounded-lg active:bg-red-900/40 touch-manipulation">
            <div class="relative z-10 flex flex-col items-center gap-2">
              <i data-lucide="flame" class="w-5 h-5 md:w-6 md:h-6 text-red-500/80 group-hover:scale-110 transition-transform duration-300"></i>
              <span class="ritual-font font-bold tracking-[0.1em] md:tracking-[0.2em] text-[10px] uppercase">Maledizione</span>
            </div>
            <!-- Shine effect -->
            <div class="absolute inset-0 -translate-x-full group-hover:animate-[shimmer_1.5s_infinite] bg-gradient-to-r from-transparent via-white/5 to-transparent skew-x-12"></div>
          </button>
        </div>

        <!-- Loader -->
        <div id="loadingIndicator" class="hidden flex justify-center py-2 h-6">
          <div class="relative text-stone-500 flex flex-col items-center gap-2">
            <div class="loader"></div>
            <span class="text-[9px] uppercase tracking-widest opacity-70">Generazione Oracolo...</span>
          </div>
        </div>
      </div>

      <!-- Log / Poetry Output -->
      <div class="terminal-bg p-4 md:p-6 font-serif italic text-sm leading-7 h-40 md:h-48 overflow-y-auto custom-scrollbar text-center text-stone-500 scroll-smooth" id="consoleLog">
        <div class="opacity-30 mt-10 md:mt-12 flex flex-col gap-2">
          <span>~ Attesa del Sacrificio ~</span>
        </div>
      </div>
    </main>

    <footer class="mt-8 md:mt-12 text-stone-800 text-[9px] font-mono relative z-10 text-center tracking-widest opacity-30 uppercase hover:opacity-100 transition-opacity pb-6">
      Grove Council &bull; MMXXIV
    </footer>
  </div>

  <script>
    (function () {
      try { lucide.createIcons(); } catch (e) {}

      const consoleLog = document.getElementById('consoleLog');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const input = document.getElementById('targetName');
      const owlContainer = document.getElementById('owlContainer');
      const mainContainer = document.getElementById('mainContainer');
      const eyeLeft = document.getElementById('eyeLeft');
      const eyeRight = document.getElementById('eyeRight');

      // ---- FIRE PARTICLES ----
      function createFireParticles() {
        const container = document.getElementById('fireContainer');
        const isMobile = window.innerWidth < 768;
        const count = isMobile ? 15 : 30; // Fewer particles on mobile for performance
        const frag = document.createDocumentFragment();
        
        for (let i = 0; i < count; i++) {
          const p = document.createElement('div');
          p.className = 'fire-particle';
          p.style.left = Math.random() * 100 + '%';
          const size = 10 + Math.random() * (isMobile ? 30 : 50);
          p.style.width = size + 'px';
          p.style.height = size + 'px';
          p.style.animationDelay = Math.random() * 5 + 's';
          p.style.animationDuration = (3 + Math.random() * 4) + 's';
          frag.appendChild(p);
        }
        container.appendChild(frag);
      }
      createFireParticles();

      // ---- AI POETRY GENERATOR LOGIC ----
      const vocab = {
        bless: {
            openers: [
                "Sotto l'ala del Gufo Eterno,",
                "Dalle ceneri del bosco sacro,",
                "Tra i rami antichi che toccano il cielo,",
                "Quando l'alba bacia la rugiada,",
                "Oltre il velo della notte oscura,",
                "Nel respiro della terra madre,"
            ],
            actions: [
                "la luce dorata discende piano.",
                "il vento porta antiche promesse.",
                "si apre un sentiero di stelle.",
                "la linfa scorre nuova e forte.",
                "gli spiriti benevoli si radunano.",
                "il fuoco purificatore danza."
            ],
            effects: [
                "Che la fortuna ti sia compagna,",
                "Ogni passo diventi una danza,",
                "Il peso del mondo svanisce ora,",
                "La saggezza guidi il tuo cuore,",
                "L'abbondanza fiorisca al tuo tocco,",
                "Ogni ombra diventi rifugio,"
            ],
            closers: [
                "e la pace trovi la tua dimora.",
                "verso un domani che splende d'oro.",
                "sotto il manto della grande quercia.",
                "sigillato nel patto della luce.",
                "finché il sole non tramonterà più.",
                "custodito dal sacro fuoco."
            ]
        },
        curse: {
            openers: [
                "Nel vuoto dove il Moloch attende,",
                "Sotto la terra fredda e spoglia,",
                "Quando la luna si tinge di sangue,",
                "Dalle profondità del bosco cieco,",
                "Al rintocco dell'ora tredicesima,",
                "Dove le radici bevono veleno,"
            ],
            actions: [
                "l'ombra si allunga e ti avvolge.",
                "il fuoco brucia ogni speranza.",
                "un gelido vento chiama il tuo nome.",
                "gli spettri ridono nel buio.",
                "il sentiero si chiude per sempre.",
                "la cenere copre ogni traccia."
            ],
            effects: [
                "Che il sonno ti sia per sempre negato,",
                "Ogni strada diventi un labirinto,",
                "Il peso del giudizio ti schiacci,",
                "La sfortuna sia la tua unica ombra,",
                "Il tuo nome sia sussurrato con timore,",
                "Ogni porta ti sia sbarrata,"
            ],
            closers: [
                "finché il debito non sarà pagato.",
                "nel silenzio eterno della notte.",
                "senza riparo dal nostro sguardo.",
                "sigillato nel patto della cenere.",
                "incatenato al destino che hai scelto.",
                "sotto l'occhio che tutto vede."
            ]
        }
      };

      function generateAIPoem(type) {
        const source = vocab[type];
        const r = (arr) => arr[Math.floor(Math.random() * arr.length)];
        return [
            r(source.openers),
            r(source.actions),
            r(source.effects),
            r(source.closers)
        ];
      }

      function setOwlState(state) {
        // Reset classes
        owlContainer.classList.remove('glow-neutral', 'glow-gold', 'glow-red');
        eyeLeft.classList.remove('eyes-dark', 'eyes-gold', 'eyes-red');
        eyeRight.classList.remove('eyes-dark', 'eyes-gold', 'eyes-red');

        // Apply new state
        if (state === 'bless') {
          owlContainer.classList.add('glow-gold');
          eyeLeft.classList.add('eyes-gold');
          eyeRight.classList.add('eyes-gold');
        } else if (state === 'curse') {
          owlContainer.classList.add('glow-red');
          eyeLeft.classList.add('eyes-red');
          eyeRight.classList.add('eyes-red');
        } else {
          owlContainer.classList.add('glow-neutral');
          eyeLeft.classList.add('eyes-dark');
          eyeRight.classList.add('eyes-dark');
        }
      }

      function logLine(text, type) {
        const div = document.createElement('div');
        div.className = "mb-2 transition-all duration-1000 opacity-0 transform translate-y-4 scale-95";
        
        if (type === 'bless') div.style.color = "#fbbf24"; 
        else if (type === 'curse') div.style.color = "#ef4444"; 
        else div.style.color = "#a8a29e";

        div.textContent = text;
        consoleLog.appendChild(div);
        
        requestAnimationFrame(() => {
          div.classList.remove('opacity-0', 'translate-y-4', 'scale-95');
          consoleLog.scrollTop = consoleLog.scrollHeight;
        });
      }

      function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

      function shakeInput(el) {
        el.classList.add('border-red-900');
        el.animate([
          { transform: 'translateX(0)' }, 
          { transform: 'translateX(-6px)' }, 
          { transform: 'translateX(6px)' }, 
          { transform: 'translateX(0)' }
        ], { duration: 400 });
        setTimeout(() => el.classList.remove('border-red-900'), 1000);
      }

      // --- Main Vibration Function ---
      function toggleEarthquake(active) {
          if(active) {
            document.body.classList.add('shake-screen');
            // Trigger haptic feedback on mobile if available
            if (navigator.vibrate) navigator.vibrate([100, 30, 100, 30, 100]);
          } else {
            document.body.classList.remove('shake-screen');
          }
      }

      async function performRitual(type) {
        const name = input.value.trim();
        if (!name) {
          shakeInput(input);
          return;
        }

        input.disabled = true;
        input.style.opacity = "0.5";
        loadingIndicator.classList.remove('hidden');
        consoleLog.innerHTML = ''; 
        
        // 1. Set Eyes and Glow immediately
        setOwlState(type);
        
        // 2. Start Earthquake
        toggleEarthquake(true);
        
        try {
          // Intro
          logLine(`INVOCANDO PER: ${name.toUpperCase()}`, 'neutral');
          // Simula tempo di calcolo AI
          await wait(1800);

          // Generate Unique Poem
          const poemLines = generateAIPoem(type);

          for (let i = 0; i < poemLines.length; i++) {
            logLine(poemLines[i], type);
            // Flash on last line
            if (i === poemLines.length - 1) triggerFlash(type);
            await wait(1400); 
          }

          // Final word
          await wait(500);
          const final = type === 'bless' ? "COSÌ SIA." : "IL PATTO È CHIUSO.";
          logLine(final, type);
          
        } finally {
          // Stop Earthquake a bit before full reset for impact
          toggleEarthquake(false);
          await wait(1500);
          
          setOwlState('neutral');
          
          loadingIndicator.classList.add('hidden');
          input.disabled = false;
          input.style.opacity = "1";
          input.value = '';
          input.focus();
        }
      }

      function triggerFlash(type) {
        const flash = document.createElement('div');
        flash.style.position = 'fixed';
        flash.style.inset = '0';
        flash.style.zIndex = '50';
        flash.style.pointerEvents = 'none';
        
        if (type === 'bless') {
             flash.style.background = 'radial-gradient(circle, rgba(251, 191, 36, 0.4) 0%, transparent 70%)';
             flash.style.mixBlendMode = 'screen';
        } else {
             flash.style.background = 'radial-gradient(circle, rgba(220, 38, 38, 0.4) 0%, transparent 70%)';
             flash.style.mixBlendMode = 'overlay';
        }

        flash.style.opacity = '0';
        flash.style.transition = 'opacity 1.5s ease-out';
        
        document.body.appendChild(flash);
        requestAnimationFrame(() => {
          flash.style.opacity = '1';
          setTimeout(() => {
            flash.style.opacity = '0';
            setTimeout(() => flash.remove(), 1500);
          }, 100);
        });
      }

      document.getElementById('btnBless').addEventListener('click', () => performRitual('bless'));
      document.getElementById('btnCurse').addEventListener('click', () => performRitual('curse'));
      
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          performRitual(e.shiftKey ? 'curse' : 'bless');
        }
      });

    })();
  </script>
</body>
</html>
