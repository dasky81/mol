<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#050202" />
  <title>Moloch Grove | Rituale</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet" />

  <!-- Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    :root{
      --bg: #050202;
      --fg: #d6d3d1;
      --red: #7f1d1d;
      --amber: #a16207;
    }

    html, body { height: 100%; }
    body {
      font-family: 'Inter', serif;
      background-color: var(--bg);
      color: var(--fg);
      overflow-x: hidden;
      padding-bottom: env(safe-area-inset-bottom);
    }

    h1, h2, h3, .ritual-font { font-family: 'Cinzel', serif; }

    /* Animations */
    @keyframes fadeInDown {
      0% { opacity: 0; transform: translateY(-14px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-down { animation: fadeInDown 700ms ease-out both; }

    @keyframes flicker {
      0%, 100% { opacity: 1; text-shadow: 0 0 15px rgba(220, 38, 38, 0.6); }
      50% { opacity: 0.82; text-shadow: 0 0 25px rgba(220, 38, 38, 0.28); }
    }
    .flicker-text { animation: flicker 4s infinite alternate; }

    .input-ritual {
      background: rgba(20, 20, 20, 0.75);
      border: 1px solid #333;
      transition: all .25s ease;
    }
    .input-ritual:focus {
      border-color: var(--red);
      box-shadow: 0 0 20px rgba(127, 29, 29, 0.4);
      outline: none;
      background: rgba(0,0,0,0.85);
    }

    /* Terminal */
    .terminal-bg {
      background-color: #050505;
      background-image:
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      background-size: 100% 2px, 3px 100%;
    }

    .btn-curse {
      background: linear-gradient(45deg, #450a0a, #7f1d1d);
      border: 1px solid #991b1b;
    }
    .btn-curse:hover { box-shadow: 0 0 30px rgba(220, 38, 38, 0.6); transform: translateY(-2px); }

    .btn-bless {
      background: linear-gradient(45deg, #422006, #854d0e);
      border: 1px solid #a16207;
    }
    .btn-bless:hover { box-shadow: 0 0 30px rgba(234, 179, 8, 0.4); transform: translateY(-2px); }

    /* Fire */
    .fire-container {
      position: fixed;
      bottom: 0; left: 0;
      width: 100%;
      height: 300px;
      z-index: 0;
      pointer-events: none;
      mask-image: linear-gradient(to top, black 20%, transparent 100%);
      -webkit-mask-image: linear-gradient(to top, black 20%, transparent 100%);
    }
    .fire-particle {
      position: absolute;
      bottom: -20px;
      width: 40px; height: 40px;
      background: radial-gradient(circle, rgba(255,80,0,0.8) 0%, rgba(100,0,0,0) 70%);
      border-radius: 999px;
      opacity: 0;
      animation: rise 3s infinite ease-in;
      filter: blur(8px);
      mix-blend-mode: screen;
    }
    @keyframes rise {
      0% { opacity: 0; transform: translateY(0) scale(1); }
      20% { opacity: 0.7; }
      50% { opacity: 0.9; background: radial-gradient(circle, rgba(255,150,50,0.8) 0%, rgba(255,50,0,0) 70%); }
      100% { opacity: 0; transform: translateY(-250px) scale(0.2); }
    }

    /* Owl Animation States */
    .owl-glow {
      filter: drop-shadow(0 0 10px rgba(255, 60, 0, 0.3));
      animation: owlIdle 5s infinite ease-in-out;
      transform-origin: center;
    }
    .owl-active {
      animation: owlRitual 0.8s infinite alternate !important;
      filter: drop-shadow(0 0 30px rgba(220, 20, 20, 0.8));
    }
    
    @keyframes owlIdle {
      0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(255, 60, 0, 0.2)); }
      50% { transform: scale(1.02); filter: drop-shadow(0 0 15px rgba(255, 60, 0, 0.4)); }
    }
    @keyframes owlRitual {
      0% { transform: scale(1.05); filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.6)); }
      100% { transform: scale(1.15); filter: drop-shadow(0 0 50px rgba(255, 0, 0, 1)); }
    }

    /* Shudder Effect */
    .shudder { animation: shudder 0.3s infinite; }
    @keyframes shudder {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-1deg); }
      20% { transform: translate(-3px, 0px) rotate(1deg); }
      30% { transform: translate(3px, 2px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(1deg); }
      50% { transform: translate(-1px, 2px) rotate(-1deg); }
      60% { transform: translate(-3px, 1px) rotate(0deg); }
      70% { transform: translate(3px, 1px) rotate(-1deg); }
      80% { transform: translate(-1px, -1px) rotate(1deg); }
      90% { transform: translate(1px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-1deg); }
    }

    /* Loader */
    .loader {
      border: 3px solid rgba(255,255,255,0.1);
      border-radius: 999px;
      border-top: 3px solid #b91c1c;
      width: 20px;
      height: 20px;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.5); }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4 relative selection:bg-red-900 selection:text-white">
  
  <!-- FIRE BACKGROUND -->
  <div class="fire-container" id="fireContainer" aria-hidden="true"></div>

  <div class="relative z-10 w-full max-w-lg flex flex-col items-center transition-transform duration-100" id="mainContainer">
    
    <!-- HEADER / MOLOCH OWL -->
    <header class="mb-8 text-center animate-fade-in-down">
      <div id="owlContainer" class="owl-glow inline-block p-6 rounded-full border-2 border-stone-800 bg-stone-950/80 mb-6 shadow-2xl relative overflow-hidden transition-colors duration-1000">
        <!-- Pulse Glow -->
        <div class="absolute top-[35%] left-[25%] w-3 h-3 bg-red-600 rounded-full blur-[4px] opacity-80 animate-pulse"></div>
        <div class="absolute top-[35%] right-[25%] w-3 h-3 bg-red-600 rounded-full blur-[4px] opacity-80 animate-pulse delay-75"></div>

        <!-- SVG Icon -->
        <svg class="w-32 h-32 text-stone-200" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <!-- Horns -->
          <path d="M20 30 L25 5 L50 15 L75 5 L80 30" stroke-width="3" />
          <!-- Face -->
          <path d="M20 30 Q10 50 20 80 L35 95 L65 95 L80 80 Q90 50 80 30" fill="#0c0a09" />
          <!-- Eyes -->
          <circle cx="35" cy="40" r="12" stroke-width="2" fill="#1c1917" />
          <circle cx="65" cy="40" r="12" stroke-width="2" fill="#1c1917" />
          <circle cx="35" cy="40" r="4" fill="currentColor" class="text-red-600 animate-pulse" />
          <circle cx="65" cy="40" r="4" fill="currentColor" class="text-red-600 animate-pulse delay-100" />
          <!-- Beak -->
          <path d="M50 55 L42 70 L58 70 Z" fill="currentColor" class="text-stone-500" />
          <!-- Wings -->
          <path d="M15 60 Q5 80 25 80" stroke-opacity="0.5" />
          <path d="M85 60 Q95 80 75 80" stroke-opacity="0.5" />
        </svg>
      </div>

      <h1 class="text-5xl md:text-6xl text-white font-black tracking-widest ritual-font flicker-text mb-2 drop-shadow-lg">MOLOCH</h1>
      <p class="text-red-900 uppercase tracking-[0.6em] text-xs font-bold border-t border-b border-red-900/30 py-1 inline-block">Cremation of Care</p>
    </header>

    <main class="w-full bg-stone-950/90 border border-stone-800 shadow-[0_0_60px_rgba(0,0,0,0.9)] rounded-xl overflow-hidden backdrop-blur-md">
      
      <div class="p-8 space-y-6">
        <div class="text-center pb-2">
          <p class="text-sm font-serif italic text-stone-400">
            "Il fuoco attende il nome. Offri il sacrificio per ricevere il giudizio."
          </p>
        </div>

        <!-- Input -->
        <div class="space-y-3">
          <div class="relative group">
            <i data-lucide="feather" class="absolute left-3 top-3.5 w-5 h-5 text-stone-600 group-focus-within:text-red-500 transition-colors" aria-hidden="true"></i>
            <input
              type="text"
              id="targetName"
              placeholder="Nome del Sacrificio"
              class="w-full pl-10 pr-4 py-3 text-stone-200 rounded-md input-ritual placeholder-stone-700 font-serif text-xl tracking-wide bg-black/50 text-center uppercase"
              autocomplete="off"
            />
          </div>
        </div>

        <div class="h-px bg-gradient-to-r from-transparent via-red-900/30 to-transparent my-6"></div>

        <!-- Buttons -->
        <div class="grid grid-cols-2 gap-4">
          <button type="button" id="btnBless" class="group relative overflow-hidden btn-bless text-amber-100 py-6 rounded-lg transition-all duration-300 transform active:scale-95 border border-amber-900/50">
            <div class="relative z-10 flex flex-col items-center gap-2">
              <i data-lucide="sun" class="w-5 h-5 text-amber-400 opacity-70 group-hover:rotate-180 transition-transform duration-1000"></i>
              <span class="ritual-font font-bold tracking-[0.2em] text-xs">BENEDIZIONE</span>
            </div>
            <div class="absolute inset-0 bg-amber-600/10 translate-y-full group-hover:translate-y-0 transition-transform duration-500"></div>
          </button>

          <button type="button" id="btnCurse" class="group relative overflow-hidden btn-curse text-red-100 py-6 rounded-lg transition-all duration-300 transform active:scale-95 border border-red-900/50">
            <div class="relative z-10 flex flex-col items-center gap-2">
              <i data-lucide="flame" class="w-5 h-5 text-red-500 opacity-70 group-hover:scale-125 transition-transform duration-300"></i>
              <span class="ritual-font font-bold tracking-[0.2em] text-xs">MALEDIZIONE</span>
            </div>
            <div class="absolute inset-0 bg-red-900/20 translate-y-full group-hover:translate-y-0 transition-transform duration-500"></div>
          </button>
        </div>

        <!-- Loader -->
        <div id="loadingIndicator" class="hidden flex justify-center py-4">
          <div class="flex flex-col items-center gap-2 text-red-900/80 font-mono text-[10px] uppercase tracking-widest">
            <div class="loader"></div>
            <span id="loadingText" class="animate-pulse">Il Gufo osserva...</span>
          </div>
        </div>
      </div>

      <!-- Log / Poetry Output -->
      <div class="terminal-bg border-t border-stone-800 p-6 font-serif italic text-sm leading-relaxed h-48 overflow-y-auto custom-scrollbar text-center text-stone-400" id="consoleLog">
        <div class="opacity-50 mb-2">~ Il bosco è silenzioso ~</div>
      </div>
    </main>

    <footer class="mt-12 text-stone-800 text-[10px] font-mono relative z-10 text-center tracking-widest opacity-40">
      THE GROVE AWAITS
    </footer>
  </div>

  <script>
    (function () {
      try { lucide.createIcons(); } catch (e) {}

      const consoleLog = document.getElementById('consoleLog');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const loadingText = document.getElementById('loadingText');
      const input = document.getElementById('targetName');
      const owlContainer = document.getElementById('owlContainer');
      const mainContainer = document.getElementById('mainContainer');

      // ---- FIRE PARTICLES ----
      function createFireParticles() {
        const container = document.getElementById('fireContainer');
        const count = 45; 
        const frag = document.createDocumentFragment();
        
        for (let i = 0; i < count; i++) {
          const p = document.createElement('div');
          p.className = 'fire-particle';
          p.style.left = Math.random() * 100 + '%';
          const size = 20 + Math.random() * 40;
          p.style.width = size + 'px';
          p.style.height = size + 'px';
          p.style.animationDelay = Math.random() * 5 + 's';
          p.style.animationDuration = (2 + Math.random() * 3) + 's';
          
          // Random red/orange tints
          const hue = Math.random() > 0.6 ? 'rgba(255,50,0,0.6)' : 'rgba(255,140,0,0.6)';
          p.style.background = `radial-gradient(circle, ${hue} 0%, rgba(0,0,0,0) 70%)`;
          
          frag.appendChild(p);
        }
        container.appendChild(frag);
      }
      createFireParticles();

      // ---- RITUAL POETRY ----
      const poems = {
        bless: [
          "Sotto l'ala del Gufo Eterno...",
          "La notte si apre, l'oro cola.",
          "Che le radici ti siano scala,",
          "E la luce guidi il tuo ritorno."
        ],
        curse: [
          "La Carestia divora la cura...",
          "Nel ventre del bosco, il fuoco ride.",
          "Ombra su ombra, il passo stride,",
          "Il Moloch sigilla la tua sventura."
        ]
      };

      function logLine(text, type) {
        const div = document.createElement('div');
        div.className = "mb-3 transition-opacity duration-1000 opacity-0 transform translate-y-2";
        
        if (type === 'bless') div.style.color = "#d97706"; // Amber
        if (type === 'curse') div.style.color = "#991b1b"; // Red

        div.textContent = text;
        consoleLog.appendChild(div);
        
        // Scroll & Animate in
        requestAnimationFrame(() => {
          div.classList.remove('opacity-0', 'translate-y-2');
          consoleLog.scrollTop = consoleLog.scrollHeight;
        });
      }

      function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

      function shakeInput(el) {
        el.classList.add('border-red-800');
        el.animate([
          { transform: 'translateX(0)' }, 
          { transform: 'translateX(-5px)' }, 
          { transform: 'translateX(5px)' }, 
          { transform: 'translateX(0)' }
        ], { duration: 300 });
        setTimeout(() => el.classList.remove('border-red-800'), 1000);
      }

      async function performRitual(type) {
        const name = input.value.trim();
        if (!name) {
          shakeInput(input);
          return;
        }

        // 1. UI SETUP
        input.disabled = true;
        loadingIndicator.classList.remove('hidden');
        consoleLog.innerHTML = ''; // Clear previous
        
        // 2. ACTIVATE OWL
        owlContainer.classList.remove('owl-glow');
        owlContainer.classList.add('owl-active');
        
        // 3. START RITUAL
        mainContainer.classList.add('shudder'); // Add slight shake to whole UI
        
        try {
          // Intro
          logLine(`Invocando per: ${name.toUpperCase()}...`, 'neutral');
          await wait(1500);

          // Poetry Loop
          const lines = poems[type];
          for (let i = 0; i < lines.length; i++) {
            logLine(lines[i], type);
            // Flash screen on last line
            if (i === lines.length - 1) triggerFlash(type);
            await wait(1200);
          }

          // Conclusion
          const final = type === 'bless' ? "COSÌ SIA." : "IL PATTO È CHIUSO.";
          logLine(final, type);
          
        } finally {
          // 4. CLEANUP
          await wait(1000);
          mainContainer.classList.remove('shudder');
          owlContainer.classList.remove('owl-active');
          owlContainer.classList.add('owl-glow');
          loadingIndicator.classList.add('hidden');
          input.disabled = false;
          input.value = '';
          input.focus();
        }
      }

      function triggerFlash(type) {
        const flash = document.createElement('div');
        flash.style.position = 'fixed';
        flash.style.inset = '0';
        flash.style.zIndex = '50';
        flash.style.pointerEvents = 'none';
        flash.style.background = type === 'bless' ? 'white' : 'red';
        flash.style.mixBlendMode = type === 'bless' ? 'overlay' : 'multiply';
        flash.style.opacity = '0.4';
        flash.style.transition = 'opacity 1s ease-out';
        
        document.body.appendChild(flash);
        requestAnimationFrame(() => {
          flash.style.opacity = '0';
          setTimeout(() => flash.remove(), 1000);
        });
      }

      document.getElementById('btnBless').addEventListener('click', () => performRitual('bless'));
      document.getElementById('btnCurse').addEventListener('click', () => performRitual('curse'));
      
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          performRitual(e.shiftKey ? 'curse' : 'bless');
        }
      });

    })();
  </script>
</body>
</html>
